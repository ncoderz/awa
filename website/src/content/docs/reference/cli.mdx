---
title: CLI Reference
description: Complete reference for the awa command-line interface — all commands, options, and usage examples.
---

import { Tabs, TabItem } from '@astrojs/starlight/components';

## Command Structure

awa organizes commands into two groups, top-level and template commands:

- `awa <cmd>` — worflow operations
- `awa template <cmd>` — template operations

## Commands

### `awa init [output]` / `awa template generate [output]`

Generate configuration files from templates. `init` is a top-level convenience command equivalent to `awa template generate` — identical behaviour, both equally valid.

```bash
awa init .                                         # current directory, default template
awa init ./my-project                              # specific output directory
awa init . --features copilot claude               # with feature flags
awa init . --preset full              # with a preset
awa init . --dry-run                  # preview without writing
awa init . --delete                   # apply deletions from template
awa init . --json                     # JSON output (implies --dry-run)
awa init . --summary                  # compact one-line summary
awa init . --overlay ./my-overrides   # layer custom files over base template
awa init --all                        # process all named targets from config
awa init --target claude              # process a specific named target
```

| Option | Description |
|--------|-------------|
| `[output]` | Output directory (positional, optional if set in config) |
| `-t, --template <source>` | Template source — local path or Git repo |
| `-f, --features <flag...>` | Feature flags (repeatable) |
| `--preset <name...>` | Preset names to enable (repeatable) |
| `--remove-features <flag...>` | Feature flags to remove (repeatable) |
| `--force` | Overwrite existing files without prompting |
| `--dry-run` | Preview changes without modifying files |
| `--delete` | Enable deletion of files listed for deletion in the template |
| `-c, --config <path>` | Path to configuration file |
| `--refresh` | Force re-fetch of cached Git templates |
| `--all` | Process all named targets from config |
| `--target <name>` | Process a specific named target from config |
| `--overlay <path...>` | Overlay directory paths applied over base template (repeatable) |
| `--json` | Output results as JSON to stdout (implies `--dry-run`) |
| `--summary` | Output compact one-line counts summary |

### `awa check`

Validate spec files against schemas and check traceability between code markers and specs.

Exit code `0` = all checks pass, `1` = errors found, `2` = internal error.

```bash
awa check                              # check with defaults
awa check --format json                # JSON output for CI
awa check --code-ignore "test/**"      # ignore specific code paths
awa check --config ./custom.toml       # custom config file
awa check --allow-warnings             # warnings don't fail
awa check --spec-only                  # skip code-to-spec traceability
```

| Option | Description |
|--------|-------------|
| `-c, --config <path>` | Path to configuration file |
| `--spec-ignore <pattern...>` | Glob patterns to exclude from spec file scanning |
| `--code-ignore <pattern...>` | Glob patterns to exclude from code file scanning |
| `--format <format>` | Output format: `text` (default) or `json` |
| `--allow-warnings` | Allow warnings without failing (default: warnings are treated as errors) |
| `--spec-only` | Run only spec-level checks (schema and cross-refs); skip code-to-spec traceability |

The check command validates:

#### Code-to-Spec Checks

| Check | Severity | Description |
|-------|----------|-------------|
| Orphaned `@awa-impl` | error | Marker references an AC ID not found in any REQ spec |
| Orphaned `@awa-test` | error | Marker references an AC or property ID not in any spec |
| Orphaned `@awa-component` | error | Marker references a component name not in any DESIGN spec |
| Uncovered AC | warning | Acceptance criterion in a REQ spec has no `@awa-test` |
| Invalid ID format | warning | Marker ID doesn't match the configured ID pattern |

#### Spec-to-Spec Checks

| Check | Severity | Description |
|-------|----------|-------------|
| Broken IMPLEMENTS | error | DESIGN component references an AC ID not in any REQ spec |
| Broken VALIDATES | error | DESIGN property references an AC or requirement ID not in any REQ spec |
| Orphaned spec | warning | Spec file's feature code isn't referenced by any marker or cross-reference |
| Marker trailing text | error | Marker contains trailing text after the ID(s) |

#### Schema Checks

| Check | Severity | Description |
|-------|----------|-------------|
| Missing section | error | Required section heading not found |
| Wrong level | warning | Section exists but at wrong heading level |
| Missing content | error | Section missing required content (pattern/list/table/code-block) |
| Table columns | error | Table columns don't match expected headers |
| Prohibited formatting | warning | Prohibited formatting pattern found outside code blocks |
| Line limit | warning | File exceeds the line limit defined in the rule |

By default, warnings are treated as errors (exit code `1`). Use `--allow-warnings` to only fail on errors.

#### Finding Codes

| Code | Severity | Description |
|------|----------|-------------|
| `orphaned-marker` | error | `@awa-impl`, `@awa-test`, or `@awa-component` references an ID not in specs |
| `uncovered-ac` | warning | Acceptance criterion has no corresponding `@awa-test` |
| `broken-cross-ref` | error | IMPLEMENTS/VALIDATES points to non-existent requirement ID |
| `invalid-id-format` | warning | Marker ID doesn't match the configured ID pattern |
| `marker-trailing-text` | error | Marker contains trailing text after the ID(s) |
| `orphaned-spec` | warning | Spec file's feature code not referenced by any marker or cross-ref |
| `schema-missing-section` | error | Required section heading not found |
| `schema-wrong-level` | warning | Section exists but at wrong heading level |
| `schema-missing-content` | error | Section missing required content |
| `schema-table-columns` | error | Table columns don't match expected headers |
| `schema-prohibited` | warning | Prohibited formatting pattern found outside code blocks |
| `schema-line-limit` | warning | File exceeds the line limit defined in the rule |

#### JSON Output Format

When `--format json` is used, output is a JSON object:

```json
{
  "valid": false,
  "errors": 3,
  "warnings": 2,
  "findings": [
    {
      "severity": "error",
      "code": "orphaned-marker",
      "message": "@awa-impl references unknown ID 'FOO-1_AC-1'",
      "filePath": "src/foo.ts",
      "line": 5,
      "id": "FOO-1_AC-1"
    },
    {
      "severity": "warning",
      "code": "uncovered-ac",
      "message": "AC 'BAR-2_AC-1' has no @awa-test",
      "id": "BAR-2_AC-1"
    }
  ]
}
```

### `awa trace [ids...]`

Explore traceability chains and assemble context from specs, code, and tests.

Exit code `0` = chain found, `1` = ID not found / no context, `2` = internal error.

```bash
awa trace DIFF-1_AC-1                    # trace a single ID
awa trace DIFF-1 DIFF-2                  # trace multiple IDs
awa trace --all                          # trace all known IDs
awa trace --task .awa/tasks/TASK-DIFF-diff-001.md  # trace IDs from a task file
awa trace --file src/core/differ.ts      # trace IDs from a source file's markers
awa trace DIFF-1 --content               # output actual file sections
awa trace DIFF-1 --content --max-tokens 4000  # cap content output size
awa trace DIFF-1 --list                  # output file paths only
awa trace DIFF-1 --json                  # JSON output
awa trace DIFF-1 --direction forward     # trace forward only
awa trace DIFF-1 --depth 2              # limit traversal depth
awa trace DIFF-1 --scope DIFF            # limit to a feature code
awa trace DIFF-1 --no-code               # exclude source code
awa trace DIFF-1 --no-tests              # exclude test files
awa trace DIFF-1 --content -C 10         # 10 lines of context before and after
```

| Option | Description |
|--------|-------------|
| `[ids...]` | Traceability ID(s) to trace (positional) |
| `--all` | Trace all known IDs in the project |
| `--task <path>` | Resolve IDs from a task file |
| `--file <path>` | Resolve IDs from a source file's markers |
| `--content` | Output actual file sections instead of locations |
| `--list` | Output file paths only (no content or tree) |
| `--max-tokens <n>` | Cap content output size (implies `--content`) |
| `--depth <n>` | Maximum traversal depth |
| `--scope <code>` | Limit results to a feature code |
| `--direction <dir>` | Traversal direction: `both` (default), `forward`, `reverse` |
| `--no-code` | Exclude source code (spec-only context) |
| `--no-tests` | Exclude test files |
| `--json` | Output as JSON |
| `-A <n>` | Lines of context after a code marker (`--content` only; default: 20) |
| `-B <n>` | Lines of context before a code marker (`--content` only; default: 5) |
| `-C <n>` | Lines of context before and after (`--content` only; overrides `-A` and `-B`) |
| `-c, --config <path>` | Path to configuration file |

### `awa template diff [target]`

Compare generated template output against an existing target directory.

Exit code `0` = files match, `1` = differences found.

```bash
awa template diff .                                # diff against current directory
awa template diff ./my-project --template ./tpl    # diff specific target and template
awa template diff . --list-unknown                 # include files not in template
awa template diff . --watch                        # watch template and re-diff on change
awa template diff . --overlay ./my-overrides       # diff against merged template view
awa template diff . --json                         # JSON output for CI
awa template diff . --summary                      # compact one-line summary
awa template diff --all                            # diff all named targets from config
awa template diff --target copilot                 # diff a specific named target
```

| Option | Description |
|--------|-------------|
| `[target]` | Target directory to compare (positional, optional if set in config) |
| `-t, --template <source>` | Template source — local path or Git repo |
| `-f, --features <flag...>` | Feature flags (repeatable) |
| `--preset <name...>` | Preset names to enable (repeatable) |
| `--remove-features <flag...>` | Feature flags to remove (repeatable) |
| `-c, --config <path>` | Path to configuration file |
| `--refresh` | Force re-fetch of cached Git templates |
| `--list-unknown` | Include files in target not present in templates |
| `--all` | Process all named targets from config |
| `--target <name>` | Process a specific named target from config |
| `-w, --watch` | Watch template directory for changes and re-run diff |
| `--overlay <path...>` | Overlay directory paths applied over base template (repeatable) |
| `--json` | Output results as JSON to stdout |
| `--summary` | Output compact one-line counts summary |

### `awa template features`

Discover feature flags available in a template.

Exit code `0` = success, `1` = error.

```bash
awa template features                              # discover flags in default template
awa template features --template ./templates/awa   # specific template
awa template features --json                       # JSON output
```

| Option | Description |
|--------|-------------|
| `-t, --template <source>` | Template source — local path or Git repo |
| `-c, --config <path>` | Path to configuration file |
| `--refresh` | Force re-fetch of cached Git templates |
| `--json` | Output results as JSON |

The features command:
- Scans all template files (including partials) for `it.features.includes('name')` references
- Lists each discovered feature flag and the files that reference it
- Includes preset definitions from `.awa.toml` if available

Example JSON output from `awa template features --json`:

```json
{
  "features": [
    { "name": "copilot", "files": ["CLAUDE.md", "_partials/_header.md"] },
    { "name": "claude", "files": ["CLAUDE.md"] }
  ],
  "presets": {
    "full": ["copilot", "claude", "cursor"]
  },
  "filesScanned": 42
}
```

### `awa template test`

Run template test fixtures to verify expected output.

Exit code `0` = all pass, `1` = failures found, `2` = internal error.

```bash
awa template test                                       # test default template
awa template test --template ./templates/awa            # test specific template
awa template test --update-snapshots                    # update stored snapshots
```

| Option | Description |
|--------|-------------|
| `-t, --template <source>` | Template source — local path or Git repo |
| `-c, --config <path>` | Path to configuration file |
| `--update-snapshots` | Update stored snapshots with current rendered output |

The test command:
- Discovers fixture files (`*.toml`) in the template's `_tests/` directory
- Renders templates for each fixture with specified features, presets, and remove-features
- Verifies expected files exist in the rendered output
- Compares rendered output against stored snapshots (if snapshot directories exist)
- Reports pass/fail per fixture with failure details

See [Template Testing](/reference/template-testing/) for the full fixture format and CI setup.

### Global Options

| Option | Description |
|--------|-------------|
| `-v, --version` | Display version number |
| `-h, --help` | Display help information |

### Update Check

awa periodically checks the npm registry for newer versions and prints a warning after command output when an update is available. The check runs asynchronously and does not slow down CLI startup.

The warning is automatically suppressed when:
- `--json` or `--summary` flags are active
- stdout is not a TTY (e.g. piped output)
- `NO_UPDATE_NOTIFIER=1` environment variable is set

Configure via `.awa.toml`:

```toml
[update-check]
enabled = true    # set to false to disable update checks
interval = 86400  # seconds between checks (default: 1 day)
```

Results are cached in `~/.cache/awa/update-check.json`. Network failures are silent — the CLI works identically when offline. See [Configuration](/reference/configuration/) for the full `[update-check]` reference.

## Template Sources

<Tabs>
  <TabItem label="Local path">
    ```bash
    awa template generate . --template ./my-templates
    awa template generate . --template /absolute/path/to/templates
    ```
  </TabItem>
  <TabItem label="GitHub">
    ```bash
    # Shorthand
    awa template generate . --template owner/repo

    # With subdirectory
    awa template generate . --template owner/repo/templates

    # With branch or tag
    awa template generate . --template owner/repo#main
    awa template generate . --template owner/repo#v1.0.0

    # Full URL
    awa template generate . --template https://github.com/owner/repo
    ```
  </TabItem>
  <TabItem label="GitLab / Bitbucket">
    ```bash
    awa template generate . --template gitlab:owner/repo
    awa template generate . --template bitbucket:owner/repo
    ```
  </TabItem>
  <TabItem label="SSH">
    ```bash
    awa template generate . --template git@github.com:owner/repo
    ```
  </TabItem>
</Tabs>

Remote templates are fetched via [degit](https://github.com/Rich-Harris/degit) and cached in `~/.cache/awa/templates/`. Use `--refresh` to re-fetch cached sources.

## Feature Resolution

Features are resolved in this order:

1. Start with `--features`
2. Expand `--preset` names (appended, deduplicated)
3. Remove `--remove-features`

```bash
# All three options combined
awa template generate . --features copilot --preset full --remove-features roo agy
```

## Multi-Target Configuration

Define `[targets.<name>]` sections in `.awa.toml` to generate different agent configurations in a single command:

```toml
template = "./templates/awa"
features = ["architect", "code"]

[targets.claude]
output = "."
features = ["claude", "architect", "code"]

[targets.copilot]
output = "."
features = ["copilot", "code", "vibe"]
```

Each target section can specify: `output`, `template`, `features`, `preset`, `remove-features`. Unspecified fields inherit from the root config.

```bash
awa template generate --all                   # process all targets
awa template generate --target claude         # process one target
awa template diff --all                       # diff all targets
awa template diff --target copilot            # diff one target
```

**Behavior notes:**

- `--all` and `--target` suppress interactive tool-feature prompting (non-interactive batch mode)
- `--all` ignores the CLI positional `[output]` argument; `--target` allows CLI positional to override the target's output
- `--force`, `--dry-run`, and `--delete` apply globally to all targets when using `--all`
- `--all` requires at least one `[targets.*]` section; errors with `NO_TARGETS` otherwise
- `--target <name>` errors with `UNKNOWN_TARGET` if the name isn't defined
- `diff --all` exit code: `0` if all targets match, `1` if any target has differences, `2` on error

See [Configuration](/reference/configuration/) for the full `[targets]` reference.

## CI Integration

Use `--json` to get structured output for CI pipelines. JSON is written to stdout; errors to stderr.

### Diff in CI

```bash
# Check for template drift — exit code 1 means differences found
awa template diff . --json > diff-result.json
```

Example JSON output from `awa template diff . --json`:

```json
{
  "diffs": [
    { "path": "file.md", "status": "modified", "diff": "--- a/file.md\n+++ b/file.md\n..." },
    { "path": "new-file.md", "status": "new" },
    { "path": "same.md", "status": "identical" }
  ],
  "counts": {
    "changed": 1,
    "new": 1,
    "matching": 1,
    "deleted": 0
  }
}
```

### Generate Preview in CI

```bash
# Preview what would be generated — --json implies --dry-run
awa template generate . --json > generate-result.json
```

Example JSON output from `awa template generate . --json`:

```json
{
  "actions": [
    { "type": "create", "path": ".github/agents/copilot.agent.md" },
    { "type": "overwrite", "path": ".github/agents/shared.agent.md" },
    { "type": "skip-equal", "path": ".github/agents/rules.agent.md" }
  ],
  "counts": {
    "created": 1,
    "overwritten": 1,
    "skipped": 1,
    "deleted": 0
  }
}
```

### Summary Output

Use `--summary` for a compact one-line output in build logs:

```bash
awa template diff . --summary
# Output: changed: 2, new: 1, matching: 10, deleted: 0

awa template generate . --summary
# Output: created: 3, overwritten: 1, skipped: 2, deleted: 0
```

## How It Works

1. **Load config** — read `.awa.toml` (if present), merge with CLI arguments
2. **Resolve template** — local path used directly; Git repos fetched via degit and cached
3. **Apply overlays** — if `--overlay` paths are given, each is resolved and merged on top of the base template (last wins)
4. **Resolve features** — combine `--features`, expand `--preset`, subtract `--remove-features`
5. **Render** — walk template directory, render each file with Eta passing `{ features }` as context
6. **Write** — create output files, prompt on conflicts (or `--force`/`--dry-run`), process `_delete.txt`
7. **Delete** — apply delete list entries only when `--delete` (or `delete = true` in config) is set
8. **Diff** (for `awa template diff`) — render to a temp directory, compare against target, report unified diffs
9. **Validate** (for `awa check`) — scan code for traceability markers, parse spec files, cross-check, report findings
10. **Test** (for `awa template test`) — discover fixtures in `_tests/`, render per fixture, verify expected files, compare snapshots
11. **Trace** (for `awa trace`) — scan markers, build index, resolve IDs, format trace chains

## Exit Codes

| Command | 0 | 1 | 2 |
|---------|---|---|---|
| `awa init` / `awa template generate` | Success | — | Internal error |
| `awa template diff` | All files match | Differences found | Internal error |
| `awa check` | All checks pass | Errors found | Internal error |
| `awa template test` | All fixtures pass | Failures found | Internal error |
| `awa template features` | Success | Error | — |
| `awa trace` | Chain found | ID not found / no context | Internal error |
